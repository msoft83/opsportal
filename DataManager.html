<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Data Manager</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <h1>ðŸ“Š Data Manager</h1>
<h3>Employees (dataset.json)</h3><table class="table table-bordered" id="empTable"></table>
<button class="btn btn-sm btn-success" onclick="addEmployee()">âž• Add Employee</button>
<button class="btn btn-sm btn-primary" onclick="exportJSON(dataset,'dataset.json')">ðŸ’¾ Export dataset.json</button>
<hr>
<h3>Stations (stations.json)</h3><table class="table table-bordered" id="stTable"></table>
<button class="btn btn-sm btn-success" onclick="addStation()">âž• Add Station</button>
<button class="btn btn-sm btn-primary" onclick="exportJSON(stations,'stations.json')">ðŸ’¾ Export stations.json</button>
  <script>
  const dsUrl = "https://raw.githubusercontent.com/msoft83/opsportal/main/data/dataset.json";
  const stUrl = "https://raw.githubusercontent.com/msoft83/opsportal/main/data/stations.json";
  let dataset=[]; let stations={};
async function loadData(){
  dataset=await fetch(dsUrl).then(r=>r.json());
  stations=await fetch(stUrl).then(r=>r.json());
  renderTables();
}
function renderTables(){
  let empHtml="<tr><th>UID</th><th>User ID</th><th>Name</th><th>Employee ID</th><th>Trainings</th><th>Actions</th></tr>";
  dataset.forEach((e,i)=>{
    empHtml+=`<tr><td contenteditable onInput="dataset[${i}].uid=this.innerText">${e.uid}</td>
    <td contenteditable onInput="dataset[${i}].user_id=this.innerText">${e.user_id}</td>
    <td contenteditable onInput="dataset[${i}].first_name=this.innerText">${e.first_name}</td>
    <td contenteditable onInput="dataset[${i}].employee_id=this.innerText">${e.employee_id}</td>
    <td contenteditable onInput="dataset[${i}].training_list=this.innerText.split(',')">${e.training_list.join(',')}</td>
    <td><button class="btn btn-sm btn-danger" onclick="delEmployee(${i})">ðŸ—‘</button></td></tr>`;
  });
  document.getElementById("empTable").innerHTML=empHtml;
  let stHtml="<tr><th>UID</th><th>Station</th><th>Actions</th></tr>";
  Object.keys(stations).forEach(uid=>{
    stHtml+=`<tr><td>${uid}</td><td contenteditable onInput="stations['${uid}']=this.innerText">${stations[uid]}</td>
    <td><button class="btn btn-sm btn-danger" onclick="delStation('${uid}')">ðŸ—‘</button></td></tr>`;
  });
  document.getElementById("stTable").innerHTML=stHtml;
}
function addEmployee(){dataset.push({uid:"U"+(dataset.length+1),user_id:"",first_name:"",employee_id:"",training_list:[]});renderTables();}
function delEmployee(i){dataset.splice(i,1);renderTables();}
function addStation(){stations["U"+(Object.keys(stations).length+1)]="";renderTables();}
function delStation(uid){delete stations[uid];renderTables();}
function exportJSON(obj, filename){const blob=new Blob([JSON.stringify(obj,null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=filename;a.click();}
loadData();
  </script>
</body>
</html>